package main

import (
	"fmt"
	"io"
	"log"
	"net/http"
	"strconv"
	"strings"
)

func main() {

	body := `{"urls": [`

	for i := 0; i < 5000; i++ {
		body += "\n\"url" + strconv.Itoa(i) + ".com\""
		if i != 4999 {
			body += ","
		}
	}
	body += `]}`

	//fmt.Println(string(body[len(body)-1000:]))

	reader := strings.NewReader(body)

	// should return {"success": true}
	r, err := http.Post("http://localhost:8080/v1/urlinfo/", "application/json", reader)
	if err != nil {
		log.Fatal(err)
	}
	b, err := io.ReadAll(r.Body)
	if err != nil {
		log.Fatal(err)
	}
	fmt.Println(string(b))

	// should return {"safe": false}
	r, err = http.Get("http://localhost:8080/v1/urlinfo/url1.com")
	if err != nil {
		log.Fatal(err)
	}
	b, err = io.ReadAll(r.Body)
	if err != nil {
		log.Fatal(err)
	}
	fmt.Println(string(b))

	r, err = http.Get("http://localhost:8080/v1/urlinfo/url2500.com")
	if err != nil {
		log.Fatal(err)
	}
	b, err = io.ReadAll(r.Body)
	if err != nil {
		log.Fatal(err)
	}
	fmt.Println(string(b))
	r, err = http.Get("http://localhost:8080/v1/urlinfo/url4999.com")
	if err != nil {
		log.Fatal(err)
	}
	b, err = io.ReadAll(r.Body)
	if err != nil {
		log.Fatal(err)
	}
	fmt.Println(string(b))

	// should return {"safe": true}
	r, err = http.Get("http://localhost:8080/v1/urlinfo/url5000.com")
	if err != nil {
		log.Fatal(err)
	}
	b, err = io.ReadAll(r.Body)
	if err != nil {
		log.Fatal(err)
	}
	fmt.Println(string(b))
}
